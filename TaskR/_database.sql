USE master
GO

ALTER DATABASE TaskR SET SINGLE_USER WITH ROLLBACK IMMEDIATE 
GO
Drop DATABASE if exists TaskR
GO

CREATE DATABASE TaskR
GO

USE TaskR
GO
	CREATE TABLE AppRole
(
	Id INT PRIMARY KEY IDENTITY,
	RoleName VARCHAR(20) NOT NULL UNIQUE
)
GO
INSERT INTO AppRole VALUES
	('Admin'),
	('FreeUser'),
	('PremiumUser')
GO
CREATE TABLE AppUser
(
	Id INT PRIMARY KEY IDENTITY,
	Username VARCHAR(50) NOT NULL,
	PasswordHash BINARY(32) NOT NULL,
	Salt BINARY(32) NOT NULL,
	RegisteredOn DATETIME NOT NULL,
	Email VARCHAR(100) UNIQUE,
	AppRoleId INT NOT NULL DEFAULT(2) REFERENCES AppRole(Id)
)
GO


CREATE TABLE ToDoList
(
	Id INT PRIMARY KEY IDENTITY,
	Name VARCHAR(30) NOT NULL,
	AppUserId int NOT NULL,
	Constraint Fk_ToDoList_AppUserId
		foreign key (AppUserId) References AppUser(Id)
)

CREATE TABLE TaskItem
(
	Id INT PRIMARY KEY IDENTITY,
	[Description] VARCHAR(100) NOT NULL,
	ToDoListId INT NOT NULL FOREIGN KEY REFERENCES ToDoList ON DELETE CASCADE,
	IsCompleted BIT NOT NULL,
	CreatedOn DATETIME NOT NULL,
	CompletedOn DATETIME,
	Deadline DATETIME, 
	Priority INT 
)
CREATE TABLE Tags
(
	Id INT PRIMARY KEY IDENTITY,
	AppUserId INT,
	Name VARCHAR(10) NOT NULL,
	HexColor CHAR(6) NOT NULL,
	Constraint Fk_Tags_AppUserId
		foreign key (AppUserId) References AppUser(Id)
)

CREATE TABLE TaskTags
(
	TaskId INT NOT NULL FOREIGN KEY REFERENCES TaskItem ON DELETE CASCADE,
	TagsId INT NOT NULL FOREIGN KEY REFERENCES Tags ON DELETE CASCADE,
	PRIMARY KEY (TaskId,TagsId)
)

-- DummyData
USE [TaskR]
GO
Insert into Tags(Name, HexColor) Values 
('Freizeit', 'ffe599'),
('Arbeit', 'b6d7a8'),
('Gesundheit', 'a2c4c9'),
('Einkaufen', 'a4c2f4'),
('Haushalt', 'b4a7d6'),
('Lernen', 'dd7e6b'),
('Finanz', 'f9cb9c')
GO
SET IDENTITY_INSERT [dbo].[AppUser] ON 
GO
INSERT [dbo].[AppUser] ([Id], [Username], [PasswordHash], [Salt], [RegisteredOn], [Email], [AppRoleId]) VALUES 
(1, N'admin', 0xE5337AE784B9E12FCEC343E973446732D2D6C9BE3BA04ABF984FAF9DE5AE19C2, 0x31A3E5C49052F12AADF17ED8BD9B07EBB865F43CA15D7E5BBCE82716BE720BB1, CAST(N'2024-05-01T00:00:00.000' AS DateTime), N'admin@taskr.com', 1),
(2, N'berni', 0xE5337AE784B9E12FCEC343E973446732D2D6C9BE3BA04ABF984FAF9DE5AE19C2, 0x31A3E5C49052F12AADF17ED8BD9B07EBB865F43CA15D7E5BBCE82716BE720BB1, CAST(N'2024-05-02T00:00:00.000' AS DateTime), N'berni@taskr.com', 2),
(3, N'danny', 0xE5337AE784B9E12FCEC343E973446732D2D6C9BE3BA04ABF984FAF9DE5AE19C2, 0x31A3E5C49052F12AADF17ED8BD9B07EBB865F43CA15D7E5BBCE82716BE720BB1, CAST(N'2024-05-03T00:00:00.000' AS DateTime), N'danny@taskr.com', 2),
(4, N'hiasl', 0xE5337AE784B9E12FCEC343E973446732D2D6C9BE3BA04ABF984FAF9DE5AE19C2, 0x31A3E5C49052F12AADF17ED8BD9B07EBB865F43CA15D7E5BBCE82716BE720BB1, CAST(N'2024-05-04T00:00:00.000' AS DateTime), N'hiasl@taskr.com', 2),
(5, N'schurli', 0xE5337AE784B9E12FCEC343E973446732D2D6C9BE3BA04ABF984FAF9DE5AE19C2, 0x31A3E5C49052F12AADF17ED8BD9B07EBB865F43CA15D7E5BBCE82716BE720BB1, CAST(N'2024-05-05T00:00:00.000' AS DateTime), N'schurli@taskr.com', 2),
(6, N'babsi', 0xE5337AE784B9E12FCEC343E973446732D2D6C9BE3BA04ABF984FAF9DE5AE19C2, 0x31A3E5C49052F12AADF17ED8BD9B07EBB865F43CA15D7E5BBCE82716BE720BB1, CAST(N'2024-05-06T00:00:00.000' AS DateTime), N'babsi@taskr.com', 2),
(7, N'andy', 0xE5337AE784B9E12FCEC343E973446732D2D6C9BE3BA04ABF984FAF9DE5AE19C2, 0x31A3E5C49052F12AADF17ED8BD9B07EBB865F43CA15D7E5BBCE82716BE720BB1, CAST(N'2024-05-07T00:00:00.000' AS DateTime), N'andy@taskr.com', 2),
(8, N'bine', 0xE5337AE784B9E12FCEC343E973446732D2D6C9BE3BA04ABF984FAF9DE5AE19C2, 0x31A3E5C49052F12AADF17ED8BD9B07EBB865F43CA15D7E5BBCE82716BE720BB1, CAST(N'2024-05-07T00:00:00.000' AS DateTime), N'bine@taskr.com', 2),
(9, N'tina', 0xE5337AE784B9E12FCEC343E973446732D2D6C9BE3BA04ABF984FAF9DE5AE19C2, 0x31A3E5C49052F12AADF17ED8BD9B07EBB865F43CA15D7E5BBCE82716BE720BB1, CAST(N'2024-05-07T00:00:00.000' AS DateTime), N'tina@taskr.com', 2),
(10, N'vicky', 0xE5337AE784B9E12FCEC343E973446732D2D6C9BE3BA04ABF984FAF9DE5AE19C2, 0x31A3E5C49052F12AADF17ED8BD9B07EBB865F43CA15D7E5BBCE82716BE720BB1, CAST(N'2024-05-07T00:00:00.000' AS DateTime), N'vicky@taskr.com', 2)
GO
SET IDENTITY_INSERT [dbo].[AppUser] OFF
GO
SET IDENTITY_INSERT [dbo].[ToDoList] ON 
GO
INSERT [dbo].[ToDoList] ([Id], [Name], [AppUserId]) VALUES 
(1, N'Arbeit', 2),
(2, N'Hausarbeiten', 2),
(3, N'Freizeit', 2),
(4, N'Kurs', 2)
GO
SET IDENTITY_INSERT [dbo].[ToDoList] OFF
GO
SET IDENTITY_INSERT [dbo].[TaskItem] ON 
GO
declare @nextweek datetime
declare @nextmonth datetime
declare @now datetime
set @now = getdate()
set @nextweek = dateadd(day,6,@now)
set @nextmonth = dateadd(day,30,@now)
INSERT [dbo].[TaskItem] ([Id], [Description], [ToDoListId], [IsCompleted], [CreatedOn], [CompletedOn], [Deadline], [Priority]) VALUES 
(1, N'Einkaufen gehen', 2, 0, @now, NULL, @nextmonth, 3),
(2, N'Wohnung aufräumen', 2, 0, @now, NULL, @nextweek, 3),
(3, N'Altpapier entsorgen', 2, 0, @now, NULL, @nextmonth, 3),
(4, N'Wäsche waschen', 2, 1, @now, @now, NULL, 3)
SET IDENTITY_INSERT [dbo].[TaskItem] OFF
GO


select * from TaskItem